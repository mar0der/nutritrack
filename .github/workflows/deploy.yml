name: Deploy NutriTrack to Ubuntu Server

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test before SSH
      run: |
        echo "Step 1: Before SSH setup"
        echo "dummy_test_file" > /tmp/test_file.txt
        cat /tmp/test_file.txt
        
    - name: Create SSH key file
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SERVER_SSH_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H ${{ secrets.SERVER_HOST }} >> ~/.ssh/known_hosts
        
    - name: Test after SSH
      run: |
        echo "Step 2: After SSH setup"
        echo "SSH key file exists:" 
        ls -la ~/.ssh/id_rsa || echo "SSH key file not found"
        echo "Test completed successfully!"